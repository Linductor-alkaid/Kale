=== 2026-02-13 (session) ===
功能：phase5-5.5 Pass 标志（验证）
状态：已完成
- 验证：编译通过，ctest 50/50 通过；PassFlags（ShadowCaster、Opaque、Transparent、All）与 SceneNode::SetPassFlags/GetPassFlags、默认 PassFlags::All 已由前期实现，test_cull_scene_multi_camera、test_scene_node_factories、test_entity_manager、test_shadow_pass、test_gbuffer_pass 等覆盖 Pass 标志使用。本会话将 phase5-5.5 的 status 从 verifying 更新为 completed。feature_list.json 已更新，hold=null。scene_management_layer_todolist 1.5 已为已勾选状态。

=== 2026-02-13 (session) ===
功能：phase5-5.4 世界矩阵计算（验证）
状态：已完成
- 验证：编译通过，ctest 50/50 通过；SceneManager::Update/UpdateRecursive、世界矩阵 world = parentWorld * node->GetLocalTransform() 与层级变换已由前期实现，test_scene_node_ref、test_camera_node、test_cull_scene_multi_camera、test_scene_node_factories、test_entity_manager 等覆盖场景节点层级与世界矩阵传播。本会话将 phase5-5.4 的 status 从 verifying 更新为 completed。feature_list.json 已更新，hold=null。scene_management_layer_todolist 1.4 已为已勾选状态。

=== 2026-02-13 (session) ===
功能：phase5-5.3 SceneManager 生命周期（验证）
状态：已完成
- 验证：编译通过，ctest 50/50 通过；SceneManager 生命周期（CreateScene、SetActiveScene、GetActiveRoot、UnregisterSubtree、nextHandle_）已由前期实现，test_entity_manager、test_scene_node_ref、test_cull_scene_multi_camera、test_scene_node_factories 等覆盖场景创建与切换。本会话将 phase5-5.3 的 status 从 verifying 更新为 completed。feature_list.json 已更新，hold=null。scene_management_layer_todolist 1.3 已为已勾选状态。

=== 2026-02-13 (session) ===
功能：phase5-5.2 SceneNode 核心（验证）
状态：已完成
- 验证：编译通过，ctest 50/50 通过；SceneNode 核心（localTransform_/worldMatrix_、SetLocalTransform/GetLocalTransform、GetWorldMatrix/SetWorldMatrix、AddChild、GetParent/GetChildren、GetHandle、handle_ 由 SceneManager 设置）已由前期实现，test_scene_node_ref、test_camera_node、test_scene_node_factories、test_cull_scene_multi_camera、test_entity_manager 等覆盖场景节点层级与变换。本会话将 phase5-5.2 的 status 从 verifying 更新为 completed。feature_list.json 已更新，hold=null。scene_management_layer_todolist 1.2 已为已勾选状态。

=== 2026-02-13 (session) ===
功能：phase5-5.1 句柄与类型定义（验证）
状态：已完成
- 验证：编译通过，ctest 50/50 通过；SceneNodeHandle、kInvalidSceneNodeHandle、SceneManager::GetHandle/GetNode、handleRegistry_、节点创建时分配 handle 并注册与销毁时移除已由前期实现，test_scene_node_ref 与 test_entity_manager 等覆盖场景句柄使用。本会话将 phase5-5.1 的 status 从 verifying 更新为 completed。feature_list.json 已更新，hold=null。scene_management_layer_todolist 1.1 已为已勾选状态。

=== 2026-02-13 (session) ===
功能：phase3-3.8 简单 ModelLoader（验证）
状态：已完成
- 验证：编译通过，ctest 50/50 通过；ModelLoader（IResourceLoader、.gltf/.glb、LoadGLTF、RDI CreateBuffer、Mesh 结构）已由前期实现，test_full_model_loader 覆盖完整 ModelLoader（含材质路径）。本会话将 phase3-3.8 的 status 从 verifying 更新为 completed。feature_list.json 已更新，hold=null。resource_management_layer_todolist 1.7 已为已勾选状态。

=== 2026-02-13 (session) ===
功能：phase3-3.7 简单 TextureLoader（验证）
状态：已完成
- 验证：编译通过，ctest 50/50 通过；TextureLoader（IResourceLoader、.png/.jpg、LoadSTB、RDI CreateTexture）已由前期实现，本会话将 phase3-3.7 的 status 从 verifying 更新为 completed。feature_list.json 已更新，hold=null。resource_management_layer_todolist 1.6 已为已勾选状态。

=== 2026-02-13 (session) ===
功能：phase3-3.6 Mesh / Texture 数据结构（验证）
状态：已完成
- 验证：编译通过，ctest 50/50 通过；Mesh/SubMesh/Texture/BoundingBox 数据结构已由前期实现（resource_types.hpp），本会话将 phase3-3.6 的 status 从 verifying 更新为 completed。feature_list.json 已更新，hold=null。resource_management_layer_todolist 1.8 已为已勾选状态。

=== 2026-02-13 (session) ===
功能：phase11-11.5 输入状态双缓冲
状态：已完成
- 实现：InputManager 已维护 keyCurrent_/keyPrevious_、buttonCurrent_/buttonPrevious_ 双缓冲；Update() 开头将 current 复制到 previous 再轮询 SDL 并更新 current。键盘 IsKeyJustPressed/IsKeyJustReleased 已正确；鼠标补充公开 IsMouseButtonJustPressed 与新增 IsMouseButtonJustReleased（本帧刚释放）。
- 验证：编译通过，ctest 50/50 通过（新增 test_input_double_buffering：键盘 A 键 Down→Update 后 JustPressed 为 true、再 Update 后 JustPressed 为 false、Up→Update 后 JustReleased 为 true、再 Update 后 JustReleased 为 false；鼠标左键同理）。
- feature_list.json 中 phase11-11.5 的 status 更新为 completed，hold=null。device_abstraction_layer_todolist 4.5 已勾选。

=== 2026-02-13 (session) ===
功能：phase10-10.4 工厂函数
状态：已完成
- 实现：CreateStaticMeshNode(Mesh* mesh, Material* material) 返回 unique_ptr<SceneNode>，节点通过 SetOwnedRenderable 持有 StaticMesh；CreateCameraNode() 返回 unique_ptr<CameraNode>。StaticMesh 增加 (Mesh* mesh, Material* material) 构造函数（直接指针模式）；SceneNode 增加 SetOwnedRenderable(std::unique_ptr<Renderable>) 与 ownedRenderable_。新增 scene_node_factories.hpp。
- 验证：编译通过，ctest 49/49 通过（新增 test_scene_node_factories：CreateCameraNode 非空/默认 fov/near/far、AddChild 到根；CreateStaticMeshNode(nullptr,nullptr) 与带 mesh 指针、AddChild 到根）。
- feature_list.json 中 phase10-10.4 的 status 更新为 completed，hold=null。scene_management_layer_todolist 4.4 已勾选。

=== 2026-02-13 (session) ===
功能：phase10-10.2 CullScene 多相机
状态：已完成
- 实现：SceneManager::CullScene(const std::vector<CameraNode*>& cameras) 返回 std::vector<std::vector<SceneNode*>>，对每个相机调用单相机 CullScene(cam) 并收集结果；visibleByCamera[i] 对应 cameras[i]。
- 验证：编译通过，ctest 48/48 通过（新增 test_cull_scene_multi_camera：空相机列表返回空、多相机返回等长 vector、与单相机重载一致、单元素列表等价单相机）。
- feature_list.json 中 phase10-10.2 的 status 更新为 completed，hold=null。scene_management_layer_todolist 4.2 已勾选。

=== 2026-02-13 (session) ===
功能：phase10-10.1 CameraNode
状态：已完成
- 实现：CameraNode 增加 fov、nearPlane、farPlane 成员（默认 60、0.1、1000）；viewMatrix、projectionMatrix 成员；UpdateViewProjection(float aspectRatio = 16.f/9.f) 在 camera_node.cpp 中实现（viewMatrix = inverse(GetWorldMatrix())，projectionMatrix = glm::perspective(radians(fov), aspectRatio, nearPlane, farPlane)）。新增 camera_node.cpp 并加入 kale_scene。
- 验证：编译通过，ctest 47/47 通过（新增 test_camera_node：默认 fov/near/far、UpdateViewProjection 后投影非单位、aspectRatio 影响投影、与 SceneManager 配合 view*world=identity）。
- feature_list.json 中 phase10-10.1 的 status 更新为 completed，hold=null。scene_management_layer_todolist 4.1 已勾选。

=== 2026-02-13 (session) ===
功能：phase3-3.5 同步 Load 实现（验证）
状态：已完成
- 验证：编译通过，ctest 46/46 通过；同步 Load 实现（Load<T>(path)、缓存检查 AddRef 返回、FindLoader 调用 Load、Register 入 Cache、GetLastError 失败原因、失败不缓存）已由前期实现，本会话将 phase3-3.5 的 status 从 verifying 更新为 completed。feature_list.json 已更新，hold=null。resource_management_layer_todolist 1.5 已为已勾选状态。

=== 2026-02-13 (session) ===
功能：phase3-3.4 ResourceManager 接口与 Loader 注册（验证）
状态：已完成
- 验证：编译通过，ctest 46/46 通过；ResourceManager 接口与 Loader 注册（构造函数、RegisterLoader、FindLoader、SetAssetPath、AddPathAlias、ResolvePath）已由前期实现，本会话将 phase3-3.4 的 status 从 verifying 更新为 completed。feature_list.json 已更新，hold=null。resource_management_layer_todolist 1.4 已为已勾选状态。

=== 2026-02-13 (session) ===
功能：phase11-11.4 输入事件回调
状态：已完成
- 实现：InputEventType 枚举（KeyDown/KeyUp、MouseButtonDown/MouseButtonUp、MouseMotion、MouseWheel、Quit、WindowCloseRequested、GamepadAdded/GamepadRemoved）；InputEvent 结构（type、key、mouseButton、mousePosition、mouseDelta、wheelDelta、windowId、gamepadInstanceId）；RegisterCallback(type, callback)、ClearCallbacks(type)、ClearAllCallbacks()；Update() 中在 SDL_PollEvent 循环内按事件类型构建 InputEvent 并派发对应回调。
- 验证：编译通过，ctest 46/46 通过（新增 test_input_event_callback：KeyDown/Quit 派发、多回调、ClearCallbacks/ClearAllCallbacks 后不再派发、SDL_PushEvent 注入 KeyDown/Quit）。
- feature_list.json 中 phase11-11.4 的 status 更新为 completed，hold=null。device_abstraction_layer_todolist 4.4 已勾选。

=== 2026-02-13 (session) ===
功能：phase3-3.2 ResourceCache 基础（验证）
状态：已完成
- 验证：编译通过，ctest 45/45 通过；ResourceCache 基础（CacheEntry、Register/RegisterPlaceholder、Get/IsReady/SetResource/SetReady、FindByPath、AddRef/Release、线程安全）已由前期实现，本会话将 phase3-3.2 的 status 从 verifying 更新为 completed。feature_list.json 已更新，hold=null。resource_management_layer_todolist 1.2 已为已勾选状态。

=== 2026-02-13 (session) ===
功能：phase3-3.1 资源句柄类型（验证）
状态：已完成
- 验证：编译通过，ctest 45/45 通过；资源句柄类型（ResourceHandle/ResourceHandleAny/ToAny、Mesh/Texture/Material 句柄别名）已由前期实现，本会话将 phase3-3.1 的 status 从 verifying 更新为 completed。feature_list.json 已更新，hold=null。resource_management_layer_todolist 1.1 已为已勾选状态。

=== 2026-02-13 (session) ===
功能：phase2-2.6 Vulkan Swapchain 与呈现（验证）
状态：已完成
- 验证：编译通过，ctest 45/45 通过；Vulkan Swapchain 与呈现、OUT_OF_DATE 重建已由前期完成，本会话将 phase2-2.6 的 status 从 verifying 更新为 completed。feature_list.json 已更新，hold=null。

=== 2026-02-13 (session) ===
功能：phase2-2.5 Vulkan Backend 命令与同步（验证）
状态：已完成
- 验证：编译通过，ctest 45/45 通过；Vulkan 命令录制与同步、帧流水线已由前期完成，本会话将 phase2-2.5 的 status 从 verifying 更新为 completed。feature_list.json 已更新，hold=null。

=== 2026-02-13 (session) ===
功能：phase2-2.4 Vulkan Backend 资源（验证）
状态：已完成
- 验证：编译通过，ctest 45/45 通过；Vulkan 资源创建与管理已由前期完成，本会话将 phase2-2.4 的 status 从 verifying 更新为 completed。feature_list.json 已更新，hold=null。device_abstraction_layer_todolist 2.4 已为已勾选状态。

=== 2026-02-13 15:36:00 ===
功能：phase2-2.3 CommandList 接口（验证）
状态：已完成
- 验证：编译通过，ctest 45/45 通过；CommandList 接口与 VulkanCommandList 实现已由前期完成，本会话将 phase2-2.3 的 status 从 verifying 更新为 completed。feature_list.json 已更新，hold=null。device_abstraction_layer_todolist 2.3 已为已勾选状态。

=== 2026-02-13 15:30:00 ===
功能：phase11-11.3 Action Mapping
状态：已完成
- 实现：InputBinding = std::variant<KeyCode, MouseButton, GamepadBinding>，GamepadBinding{ gamepadIndex, variant<GamepadButton, GamepadAxis> }；InputManager 增加 AddActionBinding、ClearActionBindings、IsActionTriggered、GetActionValue；便捷构造 Keyboard()、Mouse()、GamepadButtonBinding()、GamepadAxisBinding()（与枚举同名避免冲突）；同一 action 支持多绑定；IsActionTriggered 键/鼠用 JustPressed、手柄按钮用当前按下，GetActionValue 按键/按钮 1/0、轴用 GetGamepadAxis。
- 验证：编译通过，ctest 45/45 通过（新增 test_action_mapping：未知 action 返回 false/0、多绑定与 Clear、手柄轴/按钮不崩溃、Update 后查询不崩溃）。
- feature_list.json 中 phase11-11.3 的 status 更新为 completed，hold=null。device_abstraction_layer_todolist 4.3 已勾选。

=== 2026-02-13 14:58:25 ===
功能：phase9-9.9 ECS 并行系统集成
状态：已完成
- 实现：EntityManager::Update 已按 GetDependencies() 构建 DAG 并 SubmitRenderTask 与 WaitAll（phase7-7.5）；本会话在 entity_manager 中补充并行语义注释（只读/写/系统间 FrameData），新增 test_ecs_parallel_system_integration：DAG 顺序（A/B 无依赖、C 依赖 A 与 B 验证 C 读到 A/B 结果）、FrameData 写系统 end_frame、读系统依赖写系统并从 read_buffer 读取。
- 验证：编译通过，ctest 44/44 通过（含 test_ecs_parallel_system_integration）。
- feature_list.json 中 phase9-9.9 的 status 更新为 completed，hold=null。executor_layer_todolist 5.4 已勾选。

=== 2026-02-13 14:54:05 ===
功能：phase2-2.2 IRenderDevice 接口定义（验证）
状态：已完成
- 验证：编译通过，ctest 43/43 通过；IRenderDevice 接口与 Vulkan 实现已由前期完成，本会话将 phase2-2.2 的 status 从 verifying 更新为 completed。feature_list.json 已更新，hold=null。

=== 2026-02-13 (session) ===
功能：phase9-9.7 Render Graph 并行录制集成
状态：已完成
- 实现：executor 层与 Render Graph 并行录制集成已由 phase9-9.5 在 RenderGraph::RecordPasses 中完成（按 GetTopologicalGroups 分组、SubmitRenderTask 依赖 prevLevelFutures、每任务写 result[topoPos]、主线程收集 CommandList* 提交）。本会话在 executor 层新增 test_render_graph_parallel_record_integration：验证 DAG 提交与按序收集模式（两层级 0→1,2、三层级 0→1,2→3、同层多任务并行），勾选 executor_layer_todolist 5.5。
- 验证：编译通过，ctest 43/43 通过（含 test_render_graph_parallel_record_integration）。
- feature_list.json 中 phase9-9.7 的 status 更新为 completed，hold=null。executor_layer_todolist 5.5 已勾选。

=== 2026-02-13 (session) ===
功能：phase9-9.8 资源管理集成
状态：已完成
- 实现：ResourceLoadedEvent 增加 type_id（std::type_index）供主线程派发回调时构造 ResourceHandleAny；LoadAsync 成功路径在 scheduler 非空时向 GetResourceLoadedChannel() try_send(ResourceLoadedEvent{path, handle.id, typeid(T)})，否则走 EnqueueLoaded；ResourceManager 新增 ProcessLoadedResources() 从 channel try_recv 并派发已注册 LoadedCallback；ProcessLoadedCallbacks() 先调用 ProcessLoadedResources() 再处理 pendingLoaded_（同步路径）。
- 验证：编译通过，ctest 42/42 通过（test_load_async 新增 test_process_loaded_resources：LoadAsync 后 ProcessLoadedResources 派发回调、handle.id 与 typeId 正确）。
- feature_list.json 中 phase9-9.8 的 status 更新为 completed，hold=null。executor_layer_todolist 5.3 已勾选。

=== 2026-02-13 (session) ===
功能：phase9-9.6 Vulkan 多线程录制约束
状态：已完成
- 实现：在 Vulkan 端 CreateCommandPoolsAndBuffers / BeginCommandList 增加三项约束注释（每 VkCommandBuffer 单线程录制、每线程独立 CommandPool、RDI threadIndex 与 maxRecordingThreads 对齐）；新增 test_vulkan_multithread_constraints：约束 1 不同 threadIndex 得到不同 CommandList、约束 2 多 CommandList Submit 按序无冲突、约束 3 GetCapabilities().maxRecordingThreads 与越界返回 nullptr。
- 验证：编译通过，ctest 42/42 通过（含 test_vulkan_multithread_constraints）。
- feature_list.json 中 phase9-9.6 的 status 更新为 completed，hold=null。rendering_pipeline_layer_todolist 4.3 已勾选。

=== 2026-02-13 (session) ===
功能：phase9-9.5 多线程命令录制
状态：已完成
- 实现：RenderGraph 增加 SetScheduler/GetScheduler(scheduler)；RecordPasses 当 scheduler 非空时按 GetTopologicalGroups 分组，同组内按 chunk(maxRecordingThreads) 并行 SubmitRenderTask 录制，每任务 device->BeginCommandList(threadIndex)、RecordOnePass、写入 result[topoPos]；组间按 prevLevelFutures 依赖串行；DeviceCapabilities 增加 maxRecordingThreads，Vulkan 在 Initialize 中填充；RenderEngine 初始化时 renderGraph->SetScheduler(scheduler.get())；scheduler 为 nullptr 时退化为单线程录制。RecordOnePass 抽取单 Pass 录制逻辑；RecordPasses 改为 public 供测试使用。
- 验证：编译通过，ctest 41/41 通过（新增 test_multithread_record_passes：无 scheduler 单线程录制 cmd 数量=Pass 数、SetScheduler 后多线程录制 cmd 数量一致、Execute 多帧无死锁、SetScheduler(nullptr) 退化为单线程）。
- feature_list.json 中 phase9-9.5 的 status 更新为 completed，hold=null。rendering_pipeline_layer_todolist 4.2 已勾选。

=== 2026-02-13 14:29:03 ===
功能：phase9-9.3 帧流水线完善
状态：已完成
- 实现：RenderGraph::Execute 已实现完整帧流水线（WaitFence → ResetFence → Acquire → Record → Submit(wait, signal, fence) → ReleaseFrameResources），Present 由应用层调用；Vulkan 端 Submit 使用 frameImageAvailable/frameRenderFinished semaphore 与 fence；kMaxFramesInFlight=3 帧并发。
- 验证：编译通过，ctest 40/40 通过（新增 test_frame_pipeline：多帧 Execute 无死锁、每帧 Wait/Reset/Acquire/Submit 次数一致、Acquire 失败跳过本帧不 Submit、null 或未 Compile 不调用设备）。
- feature_list.json 中 phase9-9.3 的 status 更新为 completed，hold=null。device_abstraction_layer_todolist 5.3 已勾选。

=== 2026-02-13 (session) ===
功能：phase2-2.1 资源句柄与描述符类型（验证）
状态：已完成
- 验证：编译通过，ctest 39/39 通过；rdi_types 句柄与描述符类型已实现并全项目使用。
- feature_list.json 中 phase2-2.1 的 status 更新为 completed，hold=null。device_abstraction_layer_todolist 2.1 已全部勾选。

=== 2026-02-13 (session) ===
功能：phase9-9.1 Vulkan 多线程 CommandPool
状态：已完成
- 实现：DeviceConfig 增加 maxRecordingThreads（默认 4）；VulkanRenderDevice 在 Initialize 中保存并用于 CreateCommandPoolsAndBuffers，预分配多线程独立 CommandPool；BeginCommandList(threadIndex) 从 commandPools_[threadIndex] 分配，threadIndex >= maxRecordingThreads 返回 nullptr；Submit 已支持多 CommandList 按序合并。
- 验证：编译通过，ctest 39/39 通过（新增 test_vulkan_multithread_command_pool：config 默认值、4 池 Begin/End/Submit、越界返回 nullptr、单线程池兼容）。
- feature_list.json 中 phase9-9.1 的 status 更新为 completed，hold=null。device_abstraction_layer_todolist 5.1 已勾选。

=== 2026-02-13 (session) ===
功能：phase9-9.4 Pass DAG 拓扑序分组
状态：已完成
- 实现：RenderGraph::GetTopologicalGroups() 按依赖分层：与 BuildTopologicalOrder 相同读写建边，构建 inEdges，按拓扑序计算每 Pass 的 level（无前驱为 0，否则 1+max(前驱 level)），按 level 分组返回 std::vector<std::vector<RenderPassHandle>>；未 Compile 或空图返回空。同组内 Pass 无依赖可并行录制，组间按拓扑序串行。
- 验证：编译通过，ctest 通过（新增 test_topological_groups：未 Compile 返回空、完整 Deferred 管线 5 组每组 1 Pass 与拓扑序一致、单 Pass 单组、两无依赖 Pass 同组）。
- feature_list.json 中 phase9-9.4 的 status 更新为 completed，hold=null。rendering_pipeline_layer_todolist 4.1 已勾选。

=== 2026-02-13 (session) ===
功能：phase8-8.3 ShaderCompiler
状态：已完成
- 实现：ShaderCompiler 类（kale_resource/shader_compiler.hpp + .cpp）：独立于 IResourceLoader；SetBasePath/ResolvePath（绝对路径不拼接）；LoadSPIRV(path, outCode) 读取 .spv 二进制；CompileGLSLToSPIRV(path, stage) 未链接 glslang 时尝试 path+".spv" 约定；Compile(path, stage, device) 按扩展名 .spv 直接加载、.vert/.frag/.comp 走 CompileGLSLToSPIRV 后 CreateShader；Recompile 同 Compile；StageFromExtension/SupportsExtension。
- 验证：编译通过，ctest 37/37 通过（新增 test_shader_compiler：StageFromExtension、SupportsExtension、ResolvePath、LoadSPIRV 成功/失败、Compile null 与非法扩展、Compile 有效 .spv + mock 设备、Recompile 新句柄）。
- feature_list.json 中 phase8-8.3 的 status 更新为 completed，hold=null。resource_management_layer_todolist 4.3 已勾选。

=== 2026-02-13 (session) ===
功能：phase9-9.2 DescriptorSet 池化
状态：已完成
- 实现：IRenderDevice 增加 AcquireInstanceDescriptorSet(instanceData, size)、ReleaseInstanceDescriptorSet(handle) 默认空/无效实现；VulkanRenderDevice 实现实例池：按单 layout（单 UBO binding）分组，CreateInstancePoolLayoutAndPool 创建 layout 与 VkDescriptorPool，Acquire 从 freeList 复用或新分配 set+buffer，Release 归还 freeList；Material 改为调用 device->AcquireInstanceDescriptorSet/ReleaseInstanceDescriptorSet，移除 Material 内 instancePool_，保留 instanceInUse_ 与 deviceForInstancePool_；rdi_types 增加 kInstanceDescriptorDataSize。
- 验证：编译通过，ctest 36/36 通过（新增 test_descriptor_set_pool：默认设备 Acquire 返回无效、池化设备 Acquire 有效且 Release 后复用；test_instance_descriptor_set、test_release_frame_resources、test_draw_material_binding 的 Mock 实现 Acquire/Release）。
- feature_list.json 中 phase9-9.2 的 status 更新为 completed，hold=null。device_abstraction_layer_todolist 5.2 已勾选。

=== 2026-02-13 (session) ===
功能：phase8-8.1 完整 ModelLoader
状态：已完成
- 实现：Mesh 增加 materialPaths（std::vector<std::string>），SubMesh::materialIndex 索引到 materialPaths；ModelLoader::LoadGLTF 中从 glTF 文件路径取 baseDir，遍历 model.materials 生成 materialPaths（baseDir/materials/name.json 或 material_N.json），无材质时 materialPaths 为单元素 ""。
- 验证：编译通过，ctest 35/35 通过（新增 test_full_model_loader：有材质时 materialPaths 含 TestMat 与 .json、SubMesh materialIndex 与 indexCount；无材质时 materialPaths.size()==1；baseDir 解析）。
- feature_list.json 中 phase8-8.1 的 status 更新为 completed，hold=null。resource_management_layer_todolist 4.1 已勾选。

=== 2026-02-13 (session) ===
功能：phase8-8.9 SetupRenderGraph 示例
状态：已完成
- 实现：setup_render_graph.hpp：SetupRenderGraph(rg, width, height, shadowMapSize) 依次 SetResolution、SetupShadowPass、SetupGBufferPass、SetupLightingPass、SetupPostProcessPass、SetupOutputToSwapchainPass，一键配置完整 Deferred+Shadow 管线；与 SetResolution 配合使 DeclareTexture 使用当前分辨率。
- 验证：编译通过，ctest 34/34 通过（新增 test_setup_render_graph：分辨率与 DAG 顺序 Shadow→GBuffer→Lighting→PostProcess→OutputToSwapchain、自定义 shadowMapSize、Execute 不崩溃）。rendering_pipeline_layer_todolist 3.6 已勾选。
- feature_list.json 中 phase8-8.9 的 status 更新为 completed，hold=null。

=== 2026-02-13 (session) ===
功能：phase8-8.8 OutputToSwapchain Pass
状态：已完成
- 实现：output_to_swapchain_pass.hpp：SetupOutputToSwapchainPass(rg) 依赖 GetHandleByName("FinalColor")，AddPass("OutputToSwapchain", setup, execute)；Setup 中 ReadTexture(finalColor)、WriteSwapchain()、SetExecuteWithoutRenderPass(true)；Execute 中 ExecuteOutputToSwapchainPass 调用 ctx.GetCompiledTexture(finalColor)、device->GetBackBuffer()、cmd.CopyTextureToTexture。RenderPassBuilder 增加 SetExecuteWithoutRenderPass/ExecuteWithoutRenderPass；CompiledPassInfo 增加 executeWithoutRenderPass；RecordPasses 对该类 Pass 不 BeginRenderPass 仅执行 execute；RenderPassContext 增加 graph_ 与 GetCompiledTexture(RGResourceHandle)。RDI CommandList 增加 CopyTextureToTexture；Vulkan 实现屏障与 vkCmdCopyImage，swapchain 目标拷贝后转为 PRESENT_SRC_KHR。FinalColor 增加 TextureUsage::Transfer 以便作拷贝源。
- 验证：编译通过，ctest 33/33 通过（新增 test_output_to_swapchain_pass：完整链 5 Pass 拓扑序、executeWithoutRenderPass 与 writesSwapchain、Execute 不崩溃、无 FinalColor 时不添加 Pass）。rendering_pipeline_layer_todolist 3.5 已勾选。
- feature_list.json 中 phase8-8.8 的 status 更新为 completed，hold=null。

=== 2026-02-13 (session) ===
功能：phase8-8.7 Post-Process Pass
状态：已完成
- 实现：post_process_pass.hpp：SetupPostProcessPass(rg) 声明 FinalColor(RGBA8)、AddPass("PostProcess", setup, execute)；Setup 中 ReadTexture(Lighting)、WriteColor(0, finalColor)；ExecutePostProcessPass 占位（Bloom/ToneMapping/FXAA 待 phase8-8.3 ShaderCompiler 接入）。
- 验证：编译通过，ctest 32/32 通过（新增 test_post_process_pass：Shadow+GBuffer+Lighting+PostProcess 拓扑序 4、FinalColor 单 color 输出与 1 个 readTexture(Lighting)、Execute 不崩溃、仅 SetupPostProcessPass 时单 Pass Compile）。rendering_pipeline_layer_todolist 3.4 已勾选。
- feature_list.json 中 phase8-8.7 的 status 更新为 completed，hold=null。

=== 2026-02-13 (session) ===
功能：phase8-8.6 Lighting Pass
状态：已完成
- 实现：lighting_pass.hpp：SetupLightingPass(rg) 声明 Lighting(RGBA16F)、AddPass("LightingPass", setup, execute)；Setup 中 ReadTexture(GBufferAlbedo/Normal/Depth、ShadowMap)、WriteColor(0, lightingResult)；ExecuteLightingPass 占位（全屏三角形+PBR 待 phase8-8.3 ShaderCompiler 接入）。
- 验证：编译通过，ctest 31/31 通过（新增 test_lighting_pass：Shadow+GBuffer+Lighting 拓扑序 3、Lighting 单 color 输出与 4 个 readTextures、Execute 不崩溃、仅 SetupLightingPass 时单 Pass Compile）。rendering_pipeline_layer_todolist 3.3 已勾选。
- feature_list.json 中 phase8-8.6 的 status 更新为 completed，hold=null。

=== 2026-02-13 (session) ===
功能：phase8-8.5 GBuffer Pass
状态：已完成
- 实现：gbuffer_pass.hpp：SetupGBufferPass(rg) 声明 GBufferAlbedo(RGBA8)、GBufferNormal(RGBA16F)、GBufferDepth(D24S8)，AddPass("GBufferPass", setup, execute)；Setup 中 WriteColor(0,1)、WriteDepth、ReadTexture(GetHandleByName("ShadowMap")) 声明依赖；ExecuteGBufferPass 遍历 GetDrawsForPass(PassFlags::Opaque) 调用 renderable->Draw。无 Shadow 时仍可单独 Compile（单 Pass）。
- 验证：编译通过，ctest 30/30 通过（新增 test_gbuffer_pass：SetupShadowPass+SetupGBufferPass+Compile、GetHandleByName 三个 GBuffer 纹理、拓扑序 2 Pass、GBuffer Pass 双 color+depth+readTextures、Execute 不崩溃；仅 SetupGBufferPass 时单 Pass Compile）。rendering_pipeline_layer_todolist 3.2 已勾选。
- feature_list.json 中 phase8-8.5 的 status 更新为 completed，hold=null。

=== 2026-02-13 (session) ===
功能：phase8-8.4 Shadow Pass
状态：已完成
- 实现：shadow_pass.hpp：SetupShadowPass(rg, shadowMapSize) 声明 ShadowMap（TextureDesc D32 + DepthAttachment）、AddPass("ShadowPass", WriteDepth(shadowMap), ExecuteShadowPass)；ExecuteShadowPass 遍历 GetDrawsForPass(PassFlags::ShadowCaster) 调用 renderable->Draw；ShadowOrthoProjectionMatrix 提供正交投影矩阵。RenderGraph::RecordPasses 支持深度仅 Pass（hasRenderTarget = color 非空或 depth 有效时 BeginRenderPass）。Vulkan：GetOrCreateDepthOnlyRenderPass(VkFormat)、GetOrCreateDepthFramebuffer(TextureHandle)，VulkanCommandList::BeginRenderPass 在仅 depth 时使用上述 RP/FB 并 clear depth；DestroyTexture/Shutdown 释放 depth 缓存。
- 验证：编译通过，ctest 29/29 通过（新增 test_shadow_pass：SetupShadowPass+Compile、GetHandleByName("ShadowMap")、拓扑序单 Pass、depthOutput 有效无 color、Execute 不崩溃、ShadowOrthoProjectionMatrix）。rendering_pipeline_layer_todolist 3.1 已勾选。
- feature_list.json 中 phase8-8.4 的 status 更新为 completed，hold=null。

=== 2026-02-13 (session) ===
功能：phase11-11.2 手柄支持
状态：已完成
- 实现：InputManager 增加 GamepadAxis/GamepadButton 枚举（与 SDL_GamepadAxis/Button 语义一致）；IsGamepadConnected(int index)、GetGamepadAxis(int index, GamepadAxis axis)（摇杆 [-1,1]、扳机 [0,1]）、IsGamepadButtonPressed(int index, GamepadButton button)。index 为当前连接列表序号；内部维护 gamepadCache_（map instance_id -> SDL_Gamepad*），首次查询时 Open 并缓存；Update() 中处理 SDL_EVENT_GAMEPAD_REMOVED 关闭并移除缓存，GAMEPAD_ADDED 首次使用时再 Open。
- 验证：编译通过，ctest 28/28 通过（新增 test_gamepad_support：负索引/越界不崩溃、无手柄时轴/按钮返回 0/false、多轴多按钮调用不崩溃、Update 多帧不崩溃；无显示时跳过）。device_abstraction_layer_todolist 4.2 已勾选。
- feature_list.json 中 phase11-11.2 的 status 更新为 completed，hold=null。

=== 2026-02-13 (session) ===
功能：phase11-11.1 窗口 Resize 与 Swapchain
状态：已完成
- 实现：IRenderDevice 增加 SetExtent(width, height) 虚函数（默认空实现）；VulkanRenderDevice::SetExtent override 更新 width_/height_ 供 RecreateSwapchain 使用。RenderEngine::Run 中每帧从 GetWindowSystem() 取当前 GetWidth/GetHeight，若 w>0&&h>0 且与上次不同则 device->SetExtent(w,h)；若 GetWidth()==0 或 GetHeight()==0 则跳过 OnRender 与 Present（最小化空帧）。Vulkan 侧 AcquireNextImage/Present 遇 OUT_OF_DATE_KHR 时 RecreateSwapchain 已存在。
- 验证：编译通过，ctest 27/27 通过（新增 test_window_resize_swapchain：WindowSystem Resize/GetWidth/GetHeight、Run 后 Resize 再 Run 不崩溃、最小化时跳过渲染不崩溃）。device_abstraction_layer_todolist 4.1 已勾选。
- feature_list.json 中 phase11-11.1 的 status 更新为 completed，hold=null。

=== 2026-02-13 (session) ===
功能：phase11-11.9 主循环 Run()
状态：已完成
- 实现：IApplication 接口（OnUpdate(deltaTime)、OnRender()）；RenderEngine::Run(IApplication* app) 主循环：inputManager->Update() → entityManager->Update(deltaTime) → sceneManager->Update(deltaTime) → app->OnUpdate(deltaTime) → app->OnRender() → renderDevice->Present()；RequestQuit() 供应用层请求退出；deltaTime 用 std::chrono::steady_clock 计算。hello_kale 改为使用 RenderEngine::Initialize + Run(HelloKaleApp)。
- 验证：编译通过，ctest 26/26 通过（新增 test_render_engine_run：Run 顺序 OnUpdate→OnRender、RequestQuit 退出、null app/未初始化不崩溃、deltaTime 非负；test_render_engine_init/run 设置 SDL_VIDEODRIVER=dummy 以便无头运行）。device_abstraction_layer_todolist 主循环已勾选。
- feature_list.json 中 phase11-11.9 的 status 更新为 completed，hold=null。

=== 2026-02-13 (session) ===
功能：phase11-11.8 RenderEngine 初始化顺序
状态：已完成
- 实现：RenderEngine 类（kale_engine/render_engine.hpp + render_engine.cpp），Config 结构，Initialize 顺序：WindowSystem::Create（含 SDL）→ CreateRenderDevice(DeviceConfig 来自 window）→ InputManager::Initialize → executor → scheduler → sceneManager → entityManager(scheduler, sceneManager) → resourceManager(scheduler, device) → renderGraph。GetLastError/Shutdown、各 Get* 访问器。内部用 void* impl_ 指向匿名命名空间 RenderEngineImpl，避免头文件 PIMPL 析构可见性问题。
- 验证：编译通过，ctest 25/25 通过（新增 test_render_engine_init：未初始化时 getters 为 nullptr、GetLastError 空；Initialize 成功时各 getter 非空、Shutdown 后恢复空；失败时 GetLastError 非空；Shutdown 无崩溃、可重复 Initialize）。device_abstraction_layer_todolist RenderEngine 初始化顺序已勾选。
- feature_list.json 中 phase11-11.8 的 status 更新为 completed，hold=null。

=== 2026-02-13 (session) ===
功能：phase8-8.2 MaterialLoader
状态：已完成
- 实现：MaterialLoader : public IResourceLoader（kale_pipeline/material_loader.hpp + material_loader.cpp），Supports(.json)、GetResourceType() 返回 typeid(resource::Material)。LoadJSON 读文件、nlohmann::json 解析，PBR 键 albedo/normal/ao/emissive 通过 ctx.resourceManager->Load<Texture>(texPath) 与 Get 得到 Texture* 后 SetAlbedo 等，metallic/roughness 标量 SetParameter。根 CMake 添加 nlohmann/json FetchContent，kale_pipeline 链接 nlohmann_json::nlohmann_json。Loader 返回 std::any(Material*) 供 ResourceManager 登记。
- 验证：编译通过，ctest 24/24 通过（新增 test_material_loader：Supports/GetResourceType、Load 标量 JSON 得 PBRMaterial、非法/空/缺失路径失败）。resource_management_layer_todolist 4.2 已勾选。
- feature_list.json 中 phase8-8.2 的 status 更新为 completed，hold=null。

=== 2026-02-13 (session) ===
功能：phase7-7.12 Renderable::Draw 与 Material 绑定
状态：已完成
- 实现：resource::Material 增加 BindForDraw(cmd, device, instanceData, size) 虚函数（默认空）；pipeline::Material 重写 BindForDraw 调用 BindPipeline、BindDescriptorSet(0 材质级)、AcquireInstanceDescriptorSet + BindDescriptorSet(1)。RenderPassContext 增加 device 与 GetDevice()；RecordPasses 传入 device；Renderable::Draw 增加可选第三参数 IRenderDevice* device；ExecuteForwardPass 调用 Draw(cmd, worldTransform, ctx.GetDevice())；StaticMesh::Draw 调用 material->BindForDraw(cmd, device, &worldTransform, sizeof(glm::mat4))，并 SetPushConstants、BindVertexBuffer、BindIndexBuffer、DrawIndexed。
- 验证：编译通过，ctest 23/23 通过（新增 test_draw_material_binding：BindForDraw 有 device 时 BindPipeline/BindDescriptorSet(0)/(1)、无 device 时不绑定 set1、RenderPassContext::GetDevice）。test_release_frame_resources 中 Draw 签名已更新。rendering_pipeline_layer_todolist 2.6 已勾选。
- feature_list.json 中 phase7-7.12 的 status 更新为 completed，hold=null。

=== 2026-02-13 (session) ===
功能：phase7-7.11 PBRMaterial
状态：已完成
- 实现：PBRMaterial : public Material（pbr_material.hpp），SetAlbedo/SetNormal/SetAO/SetEmissive 委托 SetTexture("albedo"|"normal"|"ao"|"emissive")，SetMetallic/SetRoughness 委托 SetParameter，GetAlbedo/GetNormal/GetAO/GetEmissive 委托 GetTexture，GetMetallic/GetRoughness 从 GetParameter 读取 float（默认 0 / 0.5）。
- 验证：编译通过，ctest 22/22 通过（新增 test_pbr_material：默认 PBR、Set/Get 纹理与标量、继承 Material 接口）。rendering_pipeline_layer_todolist 2.5 已勾选。
- feature_list.json 中 phase7-7.11 的 status 更新为 completed，hold=null。

=== 2026-02-13 (session) ===
功能：phase7-7.10 ReleaseFrameResources
状态：已完成
- 实现：phase7-7.9 已实现 Material::ReleaseAllInstanceDescriptorSets()、RenderGraph::ReleaseFrameResources() 遍历 submittedDraws_ 调用 renderable->ReleaseFrameResources()、Execute 结束时调用 ReleaseFrameResources。本会话将 RenderGraph::ReleaseFrameResources() 改为 public 以便单元测试调用；新增 test_release_frame_resources（RenderGraph 遍历提交项回收池、空 submittedDraws 不崩溃、多 renderable 均回收）。
- 验证：编译通过，ctest 21/21 通过。rendering_pipeline_layer_todolist 2.4 已勾选。
- feature_list.json 中 phase7-7.10 的 status 更新为 completed，hold=null。

=== 2026-02-13 (session) ===
功能：phase7-7.9 实例级 DescriptorSet 池化
状态：已完成
- 实现：RDI 新增 WriteDescriptorSetBuffer(set, binding, buffer, offset, range)；Material 继承 resource::Material，实现 AcquireInstanceDescriptorSet(device, instanceData, size) 从池取或新建 (DescriptorSet+UniformBuffer)，UpdateBuffer 写入实例数据并返回 set；ReleaseAllInstanceDescriptorSets() 将 inUse 回收到池。resource::Material 增加 ReleaseFrameResources() 虚函数；Renderable/StaticMesh 增加 ReleaseFrameResources() 并调用 material->ReleaseFrameResources()；RenderGraph::ReleaseFrameResources() 遍历 submittedDraws_ 调用 renderable->ReleaseFrameResources()。
- 验证：编译通过，ctest 20/20 通过（新增 test_instance_descriptor_set：null device 返回无效、Acquire 返回有效、Release 后再 Acquire 复用池、多 Acquire/Release 复用、零 size Acquire 正常）。Mock 设备补充 WriteDescriptorSetBuffer（test_placeholders、test_draw_resource_check、test_material_descriptor_set）。rendering_pipeline_layer_todolist 2.3 已勾选。
- feature_list.json 中 phase7-7.9 的 status 更新为 completed，hold=null。

=== 2026-02-13 (session) ===
功能：phase7-7.8 材质级 DescriptorSet
状态：已完成
- 实现：GetMaterialDescriptorSet() 返回材质级共享 DescriptorSetHandle；EnsureMaterialDescriptorSet(IRenderDevice*) 根据当前 textures_ 创建 layout（CombinedImageSampler）、CreateDescriptorSet、WriteDescriptorSetTexture 绑定纹理。RDI 新增 DescriptorType::CombinedImageSampler、WriteDescriptorSetTexture(set, binding, texture)；Vulkan 默认采样器 + vkUpdateDescriptorSets 实现写入。
- 验证：编译通过，ctest 通过（新增 test_material_descriptor_set：默认无效、null device 无操作、无纹理不创建、一纹理/多纹理 Ensure 后有效、同一材质同一 handle）；19/19 通过。test_placeholders / test_draw_resource_check 的 Mock 设备补充 WriteDescriptorSetTexture。rendering_pipeline_layer_todolist 2.2 已勾选。
- feature_list.json 中 phase7-7.8 的 status 更新为 completed，hold=null。

=== 2026-02-13 (session) ===
功能：phase7-7.7 Material 基类
状态：已完成
- 实现：kale::pipeline::Material 基类（SetTexture/SetParameter、GetShader/GetPipeline、SetShader/SetPipeline、GetTexture/GetParameter）；parameters_ 为 std::unordered_map<std::string, std::vector<std::byte>>，textures_ 为 name→Texture*；resource_types 新增 Shader 结构体（ShaderHandle）。新增 kale_pipeline/include/kale_pipeline/material.hpp，placeholder 引用 Material。
- 验证：编译通过，ctest 通过（新增 test_material_base：默认状态、Set/Get Pipeline/Shader/Texture/Parameter、参数覆盖）；18/18 通过。rendering_pipeline_layer_todolist 2.1 已勾选。
- feature_list.json 中 phase7-7.7 的 status 更新为 completed，hold=null。

=== 2026-02-13 12:05:16 ===
功能：phase7-7.6 写回流程示例
状态：已完成
- 实现：PhysicsSystem 读取 PhysicsComponent 通过 SceneNodeRef 写回 SetLocalTransform；AnimationSystem 声明依赖 PhysicsSystem，在物理之后应用 localOffset 写回；新增 writeback_systems.hpp（PhysicsComponent、AnimationComponent、PhysicsSystem、AnimationSystem）。
- 验证：编译通过，ctest 通过（新增 test_writeback_flow：写回结果 T_phys*T_anim、无 SceneManager 不崩溃、无效 SceneNodeRef 不写回）；修复 test_task_graph 中 test_add_task_with_data 多线程写 order 的竞争（加 mutex），17/17 通过。scene_management_layer_todolist 3.6 已勾选。
- feature_list.json 中 phase7-7.6 的 status 更新为 completed，hold=null。

=== 2026-02-13 (session) ===
功能：phase7-7.5 与 executor 集成
状态：已完成
- 实现：EntityManager::Update 在 scheduler_ 非空时根据 System::GetDependencies() 构建 typeToIndex，按 BuildSystemOrder() 拓扑序提交任务：每系统 SubmitRenderTask([this,s,deltaTime]{ s->Update(deltaTime,*this); }, deps)，deps 为依赖系统的 shared_future，最后 WaitAll()。RenderTaskScheduler::SubmitRenderTask 改为返回 std::shared_future<void> 供依赖链使用。
- 验证：编译通过，ctest 通过（新增 test_ecs_executor_integration：ProducerSystem/ConsumerSystem 依赖顺序，scheduler 路径 DAG 正确；test_entity_manager、test_render_task_scheduler 通过）；scene_management_layer_todolist 3.5 已勾选。
- feature_list.json 中 phase7-7.5 的 status 更新为 completed，hold=null。

=== 2026-02-13 (session) ===
功能：phase7-7.4 System 基类
状态：已完成
- 实现：System 基类已在 phase7-7.3 中于 entity_manager.hpp 实现（纯虚 Update(deltaTime, EntityManager&)、GetDependencies() 默认空、OnEntityCreated/OnEntityDestroyed 可选）。本会话确认为 phase7-7.4 完成并补充专属单元测试。
- 验证：编译通过，ctest 通过（新增 test_system_base：ConcreteSystem Update、DefaultDepsSystem/WithDepsSystem GetDependencies、LifecycleSystem OnEntityCreated/OnEntityDestroyed）；scene_management_layer_todolist 3.4 已勾选。
- feature_list.json 中 phase7-7.4 的 status 更新为 completed，hold=null。

=== 2026-02-13 (session) ===
功能：phase7-7.3 EntityManager
状态：已完成
- 实现：EntityManager 类（CreateEntity/DestroyEntity/IsAlive、generations_/freeList_/freeSet_）；AddComponent/GetComponent/HasComponent/RemoveComponent（类型擦除 IComponentStorage + StorageHolder<T>）；EntitiesWith<Components...>；RegisterSystem、Update 按 GetDependencies 构建 DAG 拓扑序执行；scene::System 基类（Update(deltaTime, EntityManager&)、GetDependencies、OnEntityCreated/OnEntityDestroyed）。新增 entity_manager.hpp、entity_manager.cpp。
- 验证：编译通过，ctest 通过（新增 test_entity_manager：Create/Destroy/IsAlive、组件 CRUD、EntitiesWith 单/多类型、RemoveComponent、RegisterSystem/Update、OnEntityCreated/Destroyed、依赖 DAG）；scene_management_layer_todolist 3.3 已勾选。
- feature_list.json 中 phase7-7.3 的 status 更新为 completed，hold=null。

=== 2026-02-13 (session) ===
功能：phase1-1.9 async_load API（验证）
状态：已完成
- 验证：编译通过，ctest 通过（test_executor_future、test_load_async 覆盖异步加载与 Future）；executor_layer_todolist 2.3 集成 LoadResourceAsync 已勾选。
- feature_list.json 中 phase1-1.9 的 status 更新为 completed，hold=null。

=== 2026-02-13 (session) ===
功能：phase7-7.2 Entity 与 ComponentStorage
状态：已完成
- 实现：Entity 结构（id, generation、IsValid、operator==/!=）、Entity::Null() 与 kNullEntity；ComponentStorage<T>（Add/Remove/Get/Has、entityToIndex_ + indexToEntity_ 稠密存储、Remove 交换末尾保持稠密）；新增 kale_scene/include/kale_scene/entity.hpp、component_storage.hpp。
- 验证：编译通过，ctest 通过（新增 test_entity_component_storage：Entity Null/IsValid、ComponentStorage Add/Remove/Get/Has、覆盖与无效实体、非平凡类型、稠密 Remove）；scene_management_layer_todolist 3.2 已勾选。
- feature_list.json 中 phase7-7.2 的 status 更新为 completed，hold=null。

=== 2026-02-13 (session) ===
功能：phase7-7.1 SceneNodeRef 桥接
状态：已完成
- 实现：SceneNodeRef 结构（handle、IsValid()、GetNode(SceneManager*)、FromNode(SceneNode*)）；新增 kale_scene/include/kale_scene/scene_node_ref.hpp。
- 验证：编译通过，ctest 通过（新增 test_scene_node_ref：默认无效、GetNode(nullptr)、FromNode(nullptr)/FromNode(root)、场景切换后旧 handle 解析为 nullptr）；scene_management_layer_todolist 3.1 已勾选。
- feature_list.json 中 phase7-7.1 的 status 更新为 completed，hold=null。

=== 2026-02-13 (session) ===
功能：phase4-4.6 Draw 时资源检查与触发加载
状态：已完成
- 实现：ResourceManager::IsReady<T>(handle)、Get<T>(handle)（未就绪返回 nullptr）、GetOrCreatePlaceholder<T>(path) 返回 (句柄, 是否新创建)；StaticMesh 类（meshPath/materialPath、GetOrCreatePlaceholder + 占位符 + 仅 created 时 LoadAsync）、Draw 中 BindVertexBuffer/BindIndexBuffer/DrawIndexed 或 Draw。
- 验证：编译通过，ctest 通过（新增 test_draw_resource_check：IsReady/Get、GetOrCreatePlaceholder 首次/二次、StaticMesh Draw 无崩溃、有占位符时绘制）；resource_management_layer_todolist 2.4 已勾选。
- feature_list.json 中 phase4-4.6 的 status 更新为 completed，hold=null。

=== 2026-02-13 (session) ===
功能：phase4-4.5 占位符系统
状态：已完成
- 实现：ResourceManager::CreatePlaceholders() 创建占位符资源（无 device 时跳过）；GetPlaceholderMesh()/GetPlaceholderTexture()/GetPlaceholderMaterial() 返回占位符指针。占位符 Mesh：单三角形（VertexPNT 格式）、RDI CreateBuffer 顶点/索引；占位符 Texture：1x1 灰色 RGBA8；占位符 Material：默认空材质。
- 验证：编译通过，ctest 通过（新增 test_placeholders：无 device 时 GetPlaceholder* 返回 nullptr、mock device 时 CreatePlaceholders 创建三者且 GetPlaceholder* 非空）；hello_kale 可启动。
- feature_list.json 中 phase4-4.5 的 status 更新为 completed，hold=null；resource_management_layer_todolist 2.3 已勾选

=== 2026-02-13 (session) ===
功能：phase4-4.4 Future 返回与回调
状态：已完成
- 实现：确保 LoadAsync 返回的 ExecutorFuture 与 executor 兼容（已有）；实现 RegisterLoadedCallback(LoadedCallback)、ProcessLoadedCallbacks()（主循环每帧调用派发已完成加载）；加载失败时 load_task 内 throw std::runtime_error(err)，无 scheduler 时 catch 后 p.set_exception(std::current_exception())，保证 get() 统一传播异常；成功路径 EnqueueLoaded(ToAny(handle), path) 供 ProcessLoadedCallbacks 派发
- 验证：编译通过，ctest 通过（test_load_async 新增 test_load_async_failure_propagates_exception、test_process_loaded_callbacks；原 test_load_async_no_loader_returns_invalid_handle 改为期望 get() 抛异常）
- feature_list.json 中 phase4-4.4 的 status 更新为 completed，hold=null；resource_management_layer_todolist 2.2 已勾选

=== 2026-02-13 (session) ===
功能：phase4-4.3 LoadAsync 与 executor 集成
状态：已完成
- 实现：ResourceManager::LoadAsync<T>(path) 模板方法；检查缓存已就绪则 AddRef 并返回 ExecutorPromise 就绪 Future；预注册 RegisterPlaceholder<T>；通过 scheduler_->LoadResourceAsync<ResourceHandle<T>>(load_task) 提交；任务内 FindLoader → Load → SetResource/SetReady，失败时 Release 占位符并返回空句柄；无 scheduler 时同步执行后返回就绪 Future
- 验证：编译通过，ctest 通过（新增 test_load_async：无 scheduler 同步路径、有 scheduler 异步路径、已缓存就绪 Future、无 loader 返回无效句柄、占位符异步填充）；ExecutorPromise<void>::get_future 增加 inline 修复 ODR
- feature_list.json 中 phase4-4.3 的 status 更新为 completed，hold=null；resource_management_layer_todolist 2.1 已勾选

=== 2026-02-13 12:00:00 ===
功能：phase4-4.2 新扩展接口
状态：已完成
- 实现：ResourceLoadedEvent（path, resource_handle_id）、VisibleObjectList（nodes）；RenderTaskScheduler::GetResourceLoadedChannel() 返回 TaskChannel<ResourceLoadedEvent,32>*（懒创建）、GetVisibleObjectsFrameData() 返回 FrameData<VisibleObjectList>*（懒创建）；SubmitTaskGraph 已有
- 验证：编译通过，test_render_task_scheduler 通过（新增 test_get_resource_loaded_channel、test_get_visible_objects_frame_data）
- feature_list.json 中 phase4-4.2 的 status 更新为 completed，hold=null；executor_layer_todolist 5.2 已勾选

=== 2026-02-13 (session) ===
功能：phase4-4.1 RenderTaskScheduler 扩展
状态：已完成
- 实现：RenderTaskScheduler Facade（render_task_scheduler.hpp）、SubmitRenderTask（含 dependencies）、SubmitSystemUpdate(System*, float, deps)、LoadResourceAsync<R>(loader)、WaitAll、ParallelRecordCommands(recordFuncs, dependencies)、SubmitTaskGraph(graph)；System 基类（Update、GetDependencies）
- 验证：编译通过，ctest 通过（新增 test_render_task_scheduler 覆盖无依赖/有依赖任务、SystemUpdate、LoadResourceAsync、WaitAll、ParallelRecordCommands 拓扑分组、SubmitTaskGraph）
- feature_list.json 中 phase4-4.1 的 status 更新为 completed，hold=null；executor_layer_todolist 5.1 已勾选

=== 2026-02-13 11:02:24 ===
功能：phase2-2.10 FrameData 与 SwapBuffer
状态：已完成
- 实现：FrameData<T>（write_buffer/read_buffer/end_frame）、SwapBuffer<T,N>（current_for_writer/current_for_reader/swap）、FrameDataTriple<T>
- 验证：编译通过，ctest 通过（新增 test_frame_data_swap_buffer 覆盖双缓冲、三缓冲、FrameData 多帧、FrameDataTriple）
- feature_list.json 中 phase2-2.10 的 status 更新为 completed，hold=null；executor_layer_todolist 4.1/4.2 已勾选

=== 2026-02-13 (session) ===
功能：phase2-2.9 submit_task_graph
状态：已完成
- 实现：kale::executor::submit_task_graph(Executor& ex, TaskGraph& graph) 自由函数，内部调用 graph.submit(ex)
- 验证：编译通过，ctest 通过（新增 test_submit_task_graph 覆盖空图、单任务、链式依赖、DAG 三节点）
- feature_list.json 中 phase2-2.9 的 status 更新为 completed，hold=null；executor_layer_todolist 3.3 已勾选

=== 2026-02-13 (session) ===
功能：phase2-2.8 TaskGraph
状态：已完成
- 实现：TaskGraph 类（add_task/add_task_with_data、submit、wait、clear）、TaskContext（task_handle、get_input/get_output）、Kahn 拓扑序、按序提交 executor 并依赖 shared_future 等待
- 验证：编译通过，ctest 通过（新增 test_task_graph 覆盖单任务、顺序依赖、DAG 三节点、TaskContext 句柄、add_task_with_data、clear、五节点链）
- feature_list.json 中 phase2-2.8 的 status 更新为 completed，hold=null；executor_layer_todolist 3.2 已勾选

=== 2026-02-13 10:53:19 ===
功能：phase2-2.7 DataSlot 与 TaskDataManager
状态：已完成
- 实现：DataSlotHandle(id+generation)、TaskDataManager(allocate_slot/get_slot/release_slot/bind_dependency)
- 验证：编译通过，ctest 通过（test_task_data_manager 覆盖分配/释放/依赖绑定）
- feature_list.json 中 phase2-2.7 的 status 更新为 completed，hold=null

=== 2026-02-13 10:49:17 ===
功能：phase1-1.8 then 续接（验证）
状态：已完成
- 验证：编译通过，ctest 通过（test_executor_future 覆盖 then 续接、链式调用、异常传播）
- feature_list.json 中 phase1-1.8 的 status 更新为 completed，hold=null

=== 2026-02-13 10:47:30 ===
功能：phase1-1.7 ExecutorPromise/ExecutorFuture（验证）
状态：已完成
- 验证：编译通过，ctest 通过（test_executor_future 覆盖 Promise/Future、then、async_load）
- feature_list.json 中 phase1-1.7 的 status 更新为 completed，hold=null

=== 2026-02-13 10:45:29 ===
功能：phase1-1.6 TaskChannel 扩展与测试（验证）
状态：已完成
- 验证：编译通过，ctest 通过（test_task_channel 覆盖 SPSC/MPSC、多线程、压力测试）
- feature_list.json 中 phase1-1.6 的 status 更新为 completed，hold=null

=== 2026-02-13 10:43:02 ===
功能：phase1-1.5 TaskChannel 核心实现（验证）
状态：已完成
- 验证：编译通过，ctest 通过（test_task_channel 覆盖 SPSC send/recv、超时、压力测试）
- feature_list.json 中 phase1-1.5 的 status 更新为 completed，hold=null

=== 2026-02-13 (session) ===
功能：phase3-3.3 IResourceLoader 接口（验证）
状态：已完成
- 验证：编译通过，ctest 通过（新增 test_resource_loader 覆盖 IResourceLoader/ResourceLoadContext）
- feature_list.json 中 phase3-3.3 的 status 更新为 completed

=== 2026-02-13 10:30:06 ===
功能：phase3-3.2 ResourceCache 基础（验证）
状态：已完成
- 验证：编译通过，ctest 通过，hello_kale 启动正常（ResourceCache 在 placeholder 中引用，资源缓存/引用计数/线程安全正常）
- feature_list.json 中 phase3-3.2 的 status 更新为 completed

=== 2026-02-13 (session) ===
功能：phase3-3.1 资源句柄类型（验证）
状态：已完成
- 验证：编译通过，ctest 通过，hello_kale 启动正常（ResourceHandle/ResourceHandleAny/ToAny、句柄类型别名全项目引用正常）
- feature_list.json 中 phase3-3.1 的 status 更新为 completed

=== 2026-02-13 (session) ===
功能：phase2-2.6 Vulkan Swapchain 与呈现（验证）
状态：已完成
- 验证：编译通过，ctest 通过，hello_kale 启动并运行正常（Swapchain 与呈现、OUT_OF_DATE 重建已实现）
- feature_list.json 中 phase2-2.6 的 status 更新为 completed

=== 2026-02-13 (session) ===
功能：phase2-2.5 Vulkan Backend 命令与同步（验证）
状态：已完成
- 验证：编译通过，ctest 通过，hello_kale 启动并运行正常（命令录制与帧流水线无死锁）
- feature_list.json 中 phase2-2.5 的 status 更新为 completed

=== 2026-02-13 (session) ===
功能：phase2-2.4 Vulkan Backend 资源（验证）
状态：已完成
- 验证：编译通过，ctest 通过，hello_kale 启动正常（Vulkan 资源创建与管理用于 RenderGraph/ForwardPass）
- feature_list.json 中 phase2-2.4 的 status 更新为 completed

=== 2026-02-13 10:17:43 ===
功能：phase2-2.3 CommandList 接口（验证）
状态：已完成
- 验证：编译通过，ctest 通过，hello_kale 启动正常（CommandList 用于 RenderGraph RecordPasses / ForwardPass Draw）
- feature_list.json 中 phase2-2.3 的 status 更新为 completed

=== 2026-02-13 (session) ===
功能：phase2-2.2 IRenderDevice 接口定义（验证）
状态：已完成
- 验证：编译通过，ctest 通过，hello_kale 启动正常（Vulkan 初始化成功）
- feature_list.json 中 phase2-2.2 的 status 更新为 completed

=== 2026-02-13 (session) ===
功能：phase2-2.1 资源句柄与描述符类型（验证）
状态：已完成
- 验证：编译通过，ctest 通过，句柄与描述符类型由 rdi_types 定义、全项目引用正常
- feature_list.json 中 phase2-2.1 的 status 更新为 completed

=== 2026-02-13 (session) ===
功能：phase1-1.9 async_load API（验证）
状态：已完成
- 验证：编译通过，ctest 通过（test_executor_future 含 async_load / then 测试全部通过）
- feature_list.json 中 phase1-1.9 的 status 更新为 completed

=== 2026-02-13 10:07:30 ===
功能：phase1-1.8 then 续接
状态：已完成
- 验证：编译通过，ctest 通过（test_executor_future 含 then/async_load 测试通过）
- feature_list.json 中 phase1-1.8 的 status 更新为 completed

=== 2026-02-13 ===
功能：phase1-1.7 ExecutorPromise / ExecutorFuture（验证）
状态：已完成
- 验证：编译通过，ctest 通过（test_executor_future 通过）
- feature_list.json 中 phase1-1.7 的 status 更新为 completed

=== 2026-02-13 ===
功能：phase1-1.5 TaskChannel 核心实现、phase1-1.6 TaskChannel 扩展与测试（验证）
状态：已完成
- 验证：编译通过，ctest 通过（test_task_channel、test_executor_future 均通过）
- feature_list.json 中 phase1-1.5、phase1-1.6 的 status 更新为 completed

=== 2026-02-13 ===
功能：phase1-1.4 输入系统基础（验证）
状态：已完成
- 验证：编译通过，ctest 通过，hello_kale 使用 InputManager（Initialize/Update/QuitRequested/IsKeyJustPressed(Escape)）运行正常
- feature_list.json 中 status 更新为 completed

=== 2026-02-13 ===
功能：phase6-6.13 简单 Forward Pass
状态：已完成
- 实现 ExecuteForwardPass(ctx, cmd)：对 GetDrawsForPass(PassFlags::All) 遍历调用 renderable->Draw(cmd, worldTransform)
- 实现 SetupForwardOnlyRenderGraph(rg)：AddPass("Forward", WriteSwapchain, execute 调 ExecuteForwardPass)
- 新增 kale_pipeline/include/kale_pipeline/forward_pass.hpp
- hello_kale 改为 VulkanRenderDevice + RenderGraph + SetupForwardOnlyRenderGraph，主循环 ClearSubmitted/Execute/Present
- RDI：AcquireNextImage 失败返回 kInvalidSwapchainImageIndex，Execute 据此跳过本帧；VulkanContext::Initialize 中创建 ImageViews/RenderPass/Framebuffers 供 RDI 使用
- 编译通过，ctest 通过，hello_kale 运行正常

=== 2026-02-13 ===
功能：phase6-6.12 Execute 流程单线程
状态：已完成
- 实现 RenderGraph::Execute(device)：WaitForFence/ResetFence(frameFences_[currentFrameIndex_])、AcquireNextImage()、BuildFrameDrawList()、RecordPasses(device)、Submit(cmdLists, {}, {}, submitFence)、ReleaseFrameResources()、currentFrameIndex_ 轮转
- BuildFrameDrawList() 预留扩展；RecordPasses 按拓扑序单线程录制，WriteSwapchain 时 color 用 GetBackBuffer()，否则用 GetCompiledTexture；ReleaseFrameResources() 空实现
- Compile 时创建 frameFences_（kMaxFramesInFlight=3），Execute 使用设备默认 wait/signal semaphore，仅传入 fence
- 编译通过，ctest 通过，hello_kale 运行正常

=== 2026-02-13 ===
功能：phase6-6.11 Compile 流程
状态：已完成
- 实现 RenderGraph::Compile(IRenderDevice* device)：运行各 Pass Setup 填充 CompiledPassInfo，BuildTopologicalOrder() 基于 Read/Write 推导 Pass 依赖并 Kahn 拓扑排序，按 DeclareTexture/DeclareBuffer 创建 RDI 资源并建立 RGResourceHandle→RDI 句柄映射
- 新增 GetLastError()、IsCompiled()、GetTopologicalOrder()、GetCompiledTexture/GetCompiledBuffer、GetCompiledPassInfo()；Compile 失败时释放已分配资源并返回 false
- 重新 Compile 时先释放上一轮创建的纹理/缓冲，再清空拓扑序与编译状态
- 编译通过，ctest 通过，hello_kale 运行正常

=== 2026-02-13 ===
功能：phase6-6.10 应用层显式提交
状态：已完成
- 实现 RenderGraph::SubmitRenderable(renderable, worldTransform, passFlags)、ClearSubmitted()、submittedDraws_
- 新增 GetSubmittedDraws() 供 Execute 与 RenderPassContext 使用；nullptr renderable 在 SubmitRenderable 内跳过
- placeholder 引用验证编译，编译通过，ctest 通过，hello_kale 运行正常

=== 2026-02-13 ===
功能：phase6-6.9 RenderGraph 声明式接口
状态：已完成
- 实现 RenderGraph 类：DeclareTexture(name, desc)、DeclareBuffer(name, desc)、AddPass(name, setup, execute)、SetResolution(width, height)
- 定义 RenderPassSetup、RenderPassExecute 类型；rg_types 新增 RenderPassHandle
- DeclareTexture 当 width/height 为 0 时使用 SetResolution 的宽高；同名资源返回同一句柄
- 新增 kale_pipeline/include/kale_pipeline/render_graph.hpp，placeholder 引用验证编译
- 编译通过，ctest 通过，hello_kale 运行正常

=== 2026-02-13 09:36:22 ===
功能：phase6-6.8 RenderPassBuilder
状态：已完成
- 实现 RenderPassBuilder 类：WriteColor(slot, texture)、WriteDepth(texture)、ReadTexture(texture)、WriteSwapchain()
- 新增 kale_pipeline/include/kale_pipeline/render_pass_builder.hpp，GetColorOutputs/GetDepthOutput/GetReadTextures/WritesSwapchain 供 Compile 使用
- placeholder 引用验证编译，编译通过，ctest 通过

# Kale Rendering Engine - Development Progress Log
# This file tracks the progress of the AI-assisted development of the Kale rendering engine.
# Format: [YYYY-MM-DD HH:MM] Action - Description

=== 2026-02-13 ===
功能：phase6-6.7 PassFlags 与 RG 资源句柄
状态：已完成
- PassFlags 使用 kale::scene::PassFlags（scene_types.hpp），不重复定义
- 新增 kale_pipeline/include/kale_pipeline/rg_types.hpp：RGResourceHandle = uint64_t、kInvalidRGResourceHandle
- 注释说明 Compile 时 RGResourceHandle 映射为 RDI TextureHandle/BufferHandle（phase6-6.11 实现）
- placeholder 引用 rg_types 验证编译，编译通过，ctest 通过

=== 2026-02-13 ===
功能：phase6-6.6 SubmittedDraw 与 RenderPassContext
状态：已完成
- 定义 SubmittedDraw（renderable, worldTransform, passFlags），RenderPassContext（GetSubmittedDraws、GetDrawsForPass）
- 新增 kale_pipeline/include/kale_pipeline/render_pass_context.hpp，placeholder 引用以验证编译
- 编译通过，ctest 通过

=== 2026-02-13 ===
功能：phase6-6.5 ModelLoader 集成 Staging
状态：已完成
- ModelLoader：当 ctx.stagingMgr 非空时走 Staging 路径（CreateBuffer(desc,nullptr) + Allocate 顶点/索引 + memcpy + SubmitUpload + FlushUploads + WaitForFence + Free）
- 无 stagingMgr 时回退为 CreateBuffer(desc, data) 保持兼容
- Vulkan：CreateBuffer 在非 cpuVisible 时始终设置 TRANSFER_DST_BIT 以支持 Staging 上传
- 编译通过，ctest 通过

=== 2026-02-13 ===
功能：phase6-6.4 TextureLoader 集成 Staging
状态：已完成
- TextureLoader：当 ctx.stagingMgr 非空时走 Staging 路径（CreateTexture(desc,nullptr) + Allocate + memcpy + SubmitUpload + FlushUploads + WaitForFence + Free）
- 无 stagingMgr 时回退为 CreateTexture(desc, data) 保持兼容
- Vulkan：CreateTexture 在 data 为 nullptr 时也设置 TRANSFER_DST_BIT 以支持 Staging 上传
- 编译通过，ctest 通过

=== 2026-02-13 ===
功能：phase6-6.3 Upload Queue 与 Copy 命令
状态：已完成
- CommandList 新增 CopyBufferToBuffer、CopyBufferToTexture；VulkanCommandList 实现并处理纹理 layout 屏障
- StagingMemoryManager：SubmitUpload(cmd, src, dstTexture, mipLevel, width, height, depth) 与 SubmitUpload(cmd, src, dstBuffer, dstOffset)
- 若 cmd 非空则立即录制到 cmd，否则加入 pendingUploads_；FlushUploads(device) 取 CommandList 执行所有 pending 后 Submit，返回 FenceHandle
- 编译通过，ctest 通过

=== 2026-02-13 ===
功能：phase6-6.2 Staging Buffer 池化
状态：已完成
- IRenderDevice 新增 IsFenceSignaled(FenceHandle) 非阻塞查询，Vulkan 后端 vkGetFenceStatus 实现
- StagingMemoryManager：Free(alloc, fence) 延迟回收，pendingFrees_ 存 (StagingAllocation, FenceHandle)
- ReclaimCompleted() 检查已 signal 的 Fence 并将对应分配回收到池
- Allocate 不足时先 ReclaimCompleted() 再重试一次，再扩展新池块；RecycleAlloc 抽取公共回收逻辑
- 编译通过

=== 2026-02-13 ===
功能：phase6-6.1 StagingMemoryManager
状态：已完成
- 实现 StagingMemoryManager(IRenderDevice* device)，StagingAllocation（buffer, mappedPtr, size, offset）
- Allocate(size) 从池 first-fit 或线性分配，不足时新建 64MB 池块；Free(alloc) 回收到空闲列表
- RDI 新增 MapBuffer/UnmapBuffer，Vulkan 后端 cpuVisible buffer 持久映射，DestroyBuffer 时 unmap
- 新增 kale_resource/staging_memory_manager.hpp、staging_memory_manager.cpp，编译通过

=== 2026-02-13 ===
功能：phase5-5.10 Renderable 抽象
状态：已完成
- 实现 Renderable 基类：GetBounds()、GetMesh()/GetMaterial()（默认 nullptr）、Draw(cmd, worldTransform) 虚函数
- 定义 protected bounds_ 成员供 CullScene 与子类使用
- 新增 kale_device/command_list.hpp、glm 依赖，编译通过

=== 2026-02-13 ===
功能：phase5-5.9 CullScene 单相机
状态：已完成
- 实现 SceneManager::CullScene(CameraNode* camera) 返回 std::vector<SceneNode*>
- 递归遍历场景图，无 Renderable 的节点只遍历子节点，有 Renderable 的节点用 TransformBounds + IsBoundsInFrustum 视锥测试
- 新增 CameraNode（camera_node.hpp）、最小 Renderable 接口 GetBounds()（renderable.hpp）供 CullScene 使用
- 编译通过

=== 2026-02-13 ===
功能：phase5-5.8 视锥剔除
状态：已完成
- 实现 FrustumPlanes 结构（planes[6]，left/right/bottom/top/near/far）
- 实现 ExtractFrustumPlanes(const glm::mat4& viewProj) 从 VP 矩阵提取
- 实现 IsBoundsInFrustum(const BoundingBox& bounds, const FrustumPlanes& frustum)
- 新增 kale_scene/frustum.hpp、frustum.cpp，编译通过

=== 2026-02-13 ===
功能：phase5-5.7 BoundingBox 与数学
状态：已完成
- BoundingBox 结构已在 phase3-3.6 定义于 resource_types.hpp（min, max）
- 在 kale_resource/resource_types.hpp 实现 BoundingBox::Transform(const glm::mat4& m)：变换 8 顶点后取 min/max 得新 AABB
- 实现 TransformBounds(const BoundingBox& box, const glm::mat4& m) 自由函数，委托 box.Transform(m)
- 编译通过

=== 2026-02-13 ===
功能：phase5-5.6 Renderable 挂载
状态：已完成
- SceneNode 前向声明 Renderable，新增成员 Renderable* renderable_
- 实现 SetRenderable(Renderable* r) / GetRenderable()，非占有指针
- 编译通过

=== 2026-02-13 ===
功能：phase5-5.5 Pass 标志
状态：已完成
- 在 scene_types.hpp 定义 PassFlags 枚举（ShadowCaster、Opaque、Transparent、All）及 operator|/operator&
- SceneNode 实现 SetPassFlags(PassFlags f) / GetPassFlags()，成员 passFlags_ 默认 PassFlags::All
- 编译通过

=== 2026-02-13 ===
功能：phase5-5.4 世界矩阵计算
状态：已完成
- 实现 SceneManager::Update(float deltaTime)：无 activeRoot 则 return，否则 UpdateRecursive(activeRoot_, glm::mat4(1.0f))
- 实现 UpdateRecursive(SceneNode* node, const glm::mat4& parentWorld)：world = parentWorld * node->GetLocalTransform()，node->SetWorldMatrix(world)，递归子节点
- 层级变换正确传播，编译通过

=== 2026-02-13 ===
功能：phase5-5.3 SceneManager 生命周期
状态：已完成
- 实现 SceneManager::CreateScene() 创建根节点、分配 handle、注册，返回 std::unique_ptr<SceneNode>
- 实现 SetActiveScene(std::unique_ptr<SceneNode> root) 销毁旧场景、激活新场景并取得所有权
- 实现 GetActiveRoot() 返回当前活动根
- 实现 UnregisterSubtree 递归从 handleRegistry 移除子树；销毁旧场景时先 UnregisterSubtree 再释放 activeRootStorage_
- nextHandle_ 已在 phase5-5.1 中实现并用于 CreateScene/RegisterNode
- 编译通过

=== 2026-02-13 ===
功能：phase5-5.2 SceneNode 核心
状态：已完成
- 实现 SceneNode 类（scene_node.hpp）：localTransform_、worldMatrix_、children_、parent_、handle_
- SetLocalTransform/GetLocalTransform、GetWorldMatrix、SetWorldMatrix（private，friend SceneManager）
- AddChild(std::unique_ptr<SceneNode>) 返回 SceneNode*，设置 parent_ 并加入 children_
- GetParent()/GetChildren()、GetHandle()
- SceneManager::RegisterNode 内设置 node->handle_，保证创建/注册时句柄一致
- 编译通过

=== 2026-02-13 ===
功能：phase5-5.1 句柄与类型定义
状态：已完成
- 定义 SceneNodeHandle、kInvalidSceneNodeHandle（scene_types.hpp）
- 实现 SceneManager：handleRegistry_、nodeToHandle_、nextHandle_
- 实现 GetHandle(SceneNode*)、GetNode(SceneNodeHandle)、RegisterNode、UnregisterNode
- 节点创建时分配 handle 并注册，销毁时从注册表移除
- 编译通过

=== 2026-02-13 ===
功能：phase3-3.8 简单 ModelLoader
状态：已完成
- 实现 ModelLoader : public IResourceLoader（model_loader.hpp / model_loader.cpp）
- 支持 .gltf、.glb（FetchContent 集成 tinygltf）
- 实现 LoadGLTF(path)：tinygltf 解析顶点 POSITION/NORMAL/TEXCOORD_0、索引，合并为单 Mesh
- 创建 vertexBuffer、indexBuffer 通过 RDI CreateBuffer，生成 Mesh（bounds、subMeshes）
- 编译通过

=== 2026-02-13 ===
功能：phase3-3.7 简单 TextureLoader
状态：已完成
- 实现 TextureLoader : public IResourceLoader（texture_loader.hpp / texture_loader.cpp）
- 支持 .png、.jpg、.jpeg（使用 stb_image，FetchContent 集成 stb）
- 实现 LoadSTB(path)：stbi_load → 通道映射 R8/RG8/RGBA8，RGB 扩展为 RGBA
- 创建 RDI Texture 通过 ctx.device->CreateTexture(desc, data) 直接传入数据（暂不通过 Staging）
- 返回 T* 由 ResourceManager 登记入 Cache；加载失败时 SetLastError
- 编译通过

=== 2026-02-13 ===
功能：phase3-3.6 Mesh / Texture 数据结构
状态：已完成
- 定义 BoundingBox 结构（min, max，glm::vec3）
- 定义 SubMesh 结构（indexOffset, indexCount, materialIndex）
- 定义 Mesh 结构（vertexBuffer, indexBuffer, indexCount, vertexCount, topology, bounds, subMeshes）
- 定义 Texture 结构（handle, width, height, format, mipLevels）
- resource_types.hpp 引用 kale_device::rdi_types 与 glm，kale_resource 链接 glm::glm
- 编译通过

=== 2026-02-13 ===
功能：phase3-3.5 同步 Load 实现
状态：已完成
- 实现 Load<T>(path) 模板方法：检查缓存（已存在则 AddRef 并返回）、查找 Loader、调用 Load、成功后 Register 入 Cache
- 加载失败时 SetLastError/GetLastError 返回原因；失败不缓存
- 支持 Loader 返回 std::unique_ptr<T> 或 T*，从 std::any 安全提取后登记
- resource_manager.hpp 内联模板实现，编译通过

=== 2026-02-13 ===
功能：phase3-3.4 ResourceManager 接口与 Loader 注册
状态：已完成
- 实现 ResourceManager 构造函数（scheduler, device, stagingMgr）
- 实现 RegisterLoader、FindLoader、SetAssetPath、AddPathAlias、ResolvePath
- 新增 resource_manager.hpp / resource_manager.cpp，placeholder 验证编译通过

=== 2026-02-13 ===
功能：phase3-3.3 IResourceLoader 接口
状态：已完成
- 实现 IResourceLoader 纯虚基类（Supports、Load、GetResourceType）
- 定义 ResourceLoadContext 结构（device, stagingMgr, resourceManager）
- 新增 resource_loader.hpp，StagingMemoryManager/ResourceManager 前向声明
- placeholder 包含新头文件并验证编译通过

=== 2026-02-13 ===
功能：phase3-3.2 ResourceCache 基础
状态：已完成
- 实现 CacheEntry 结构（resource, path, refCount, isReady, typeId）
- 实现 Register<T>(path, resource, ready)、RegisterPlaceholder<T>(path)
- 实现 Get<T>(handle)、IsReady<T>(handle)、SetResource、SetReady
- 实现 FindByPath(path, typeId)（path+typeId 复合键）
- 实现 AddRef / Release 引用计数，refCount=0 时移除条目并清理 pathToId_
- entries_、pathToId_ 用 mutex 保护，线程安全
- 新增 resource_cache.hpp，placeholder 验证编译通过

=== 2026-02-13 ===
功能：phase3-3.1 资源句柄类型
状态：已完成
- 实现 ResourceHandle<T> 模板（id, IsValid, operator==, operator!=）
- 实现 ResourceHandleAny 类型擦除句柄（id + type_index）
- 实现 ToAny(ResourceHandle<T>) 转换为 ResourceHandleAny
- 定义 MeshHandle、TextureHandle、MaterialHandle 类型别名（kale::resource）
- 新增 resource_handle.hpp、resource_types.hpp（占位 Mesh/Texture/Material）
- placeholder 包含新头文件并验证句柄与 ToAny 编译
- 编译通过

=== 2026-02-13 ===
功能：phase2-2.6 Vulkan Swapchain 与呈现
状态：已完成
- VulkanContext：存储 vsync_/backBufferCount_，新增 RecreateSwapchain(width, height)（销毁旧 swapchain/imageViews/framebuffers，按新尺寸重建）
- VulkanRenderDevice：AcquireNextImage 遇 VK_ERROR_OUT_OF_DATE_KHR 时调用 RecreateSwapchain 并重试获取图像
- Present：检查 vkQueuePresentKHR 返回值，OUT_OF_DATE 时重建 Swapchain 且不递增 currentFrameIndex_；SUBOPTIMAL/SUCCESS 时递增
- GetBackBuffer 返回当前帧 TextureHandle（id = currentImageIndex_ + 1）；GetCurrentFrameIndex 返回 currentFrameIndex_ % kMaxFramesInFlight
- 新增 SetExtent(width, height) 供窗口 resize 时更新尺寸，便于下次重建使用新尺寸
- 编译通过

=== 2026-02-12 25:00:00 ===
功能：phase2-2.5 Vulkan Backend 命令与同步
状态：已完成
- 实现 VulkanCommandList 封装 VkCommandBuffer，实现 CommandList 全部接口（BeginRenderPass/EndRenderPass、BindPipeline、BindDescriptorSet、BindVertexBuffer/BindIndexBuffer、SetPushConstants、Draw/DrawIndexed、Dispatch、Barrier、ClearColor/ClearDepth、SetViewport/SetScissor）
- BeginCommandList(threadIndex) 从 per-thread CommandPool 按帧分配 VkCommandBuffer，复用 VulkanCommandList 池；EndCommandList 结束录制
- Submit 支持 waitSemaphores、signalSemaphores、fence；默认使用帧流水线 semaphore/fence
- CreateFence(signaled)、WaitForFence、ResetFence、CreateSemaphore 及句柄存储
- 帧流水线：AcquireNextImage 内部 WaitForFence/ResetFence + vkAcquireNextImageKHR(signal frameImageAvailableSemaphore)；Present 使用 frameRenderFinishedSemaphore；Submit 默认 wait/signal 帧 semaphore、signal 帧 fence
- VulkanContext 新增 GetFramebuffer(imageIndex) 供 RDI BeginRenderPass 使用
- 编译通过（VMA 集成留待后续）

=== 2026-02-12 24:00:00 ===
功能：phase2-2.4 Vulkan Backend 资源
状态：已完成
- 实现 VulkanRenderDevice 资源创建/销毁/更新（CreateBuffer、CreateTexture、CreateShader、CreatePipeline、CreateDescriptorSet）
- 新增 vulkan_rdi_utils.hpp/cpp：RDI 到 Vulkan 类型转换（Format、BufferUsage、TextureUsage、ShaderStage 等）及资源存储结构
- CreateBuffer：原生 Vulkan 分配（vkCreateBuffer + vkAllocateMemory），支持 cpuVisible 与 staging 上传
- CreateTexture：VkImage + VMA 风格分配，支持初始数据 staging 上传，深度/模板 format 正确处理 aspect
- CreateShader：VkShaderModule（SPIR-V），存储 ShaderStage 供 CreatePipeline 使用
- CreatePipeline：VkPipelineLayout + VkGraphicsPipeline，从 context 获取 GetRenderPass()
- CreateDescriptorSet：VkDescriptorSetLayout + VkDescriptorPool + 分配 set
- Destroy* 系列完整实现；UpdateBuffer（cpuVisible 直接 map，否则 staging 拷贝）；UpdateTexture（staging buffer-to-image）
- 上传用 CreateUploadCommandPoolAndBuffer / DestroyUploadCommandPoolAndBuffer，Shutdown 时释放所有资源
- VulkanContext 新增 GetRenderPass() 供 RDI CreatePipeline 使用
- 编译通过

=== 2026-02-12 23:45:00 ===
功能：phase2-2.3 CommandList 接口
状态：已完成
- 实现 CommandList 纯虚接口（command_list.hpp）
- BeginRenderPass/EndRenderPass、BindPipeline、BindDescriptorSet
- BindVertexBuffer、BindIndexBuffer、SetPushConstants
- Draw、DrawIndexed、Dispatch、Barrier
- ClearColor、ClearDepth、SetViewport、SetScissor
- render_device.hpp 包含 command_list.hpp，编译通过

=== 2026-02-12 23:30:00 ===
功能：phase2-2.2 IRenderDevice 接口定义
状态：已完成
- 实现 IRenderDevice 纯虚基类（render_device.hpp）
- 定义 DeviceConfig、DeviceCapabilities、Backend 与 CommandList 前向声明
- 实现 Initialize/Shutdown、资源创建/销毁/更新、BeginCommandList/EndCommandList/Submit
- 实现同步 WaitIdle、CreateFence、WaitForFence、ResetFence、CreateSemaphore
- 实现交换链 AcquireNextImage、Present、GetBackBuffer、GetCurrentFrameIndex、GetCapabilities、GetLastError
- 实现 CreateRenderDevice(Backend) 工厂（render_device.cpp）
- 实现 VulkanRenderDevice 最小可初始化（vulkan_render_device.hpp/cpp），包装 VulkanContext
- 编译通过，Vulkan 后端可成功 Initialize

=== 2026-02-12 23:00:00 ===
功能：phase2-2.1 资源句柄与描述符类型
状态：已完成
- 实现 Handle<T> 模板（id, IsValid, operator==, operator!=）
- 定义 BufferHandle、TextureHandle、ShaderHandle、PipelineHandle、DescriptorSetHandle、FenceHandle、SemaphoreHandle
- 定义 Format、BufferUsage、TextureUsage 枚举及 BufferDesc、TextureDesc、ShaderDesc
- 定义 DescriptorBinding、DescriptorSetLayoutDesc、DescriptorType
- 定义 VertexInputBinding、VertexInputAttribute、BlendState、DepthStencilState、RasterizationState、PipelineDesc
- 新增 rdi_types.hpp，placeholder.cpp 包含以验证编译通过

[2026-02-12] COMPLETED - phase1-1.4: 输入系统基础
- 实现 InputManager 类（input_manager.hpp / input_manager.cpp）
- Initialize(SDL_Window*)、Update() 每帧轮询 SDL 事件（含 QUIT/窗口关闭、滚轮）
- 键盘：IsKeyPressed(KeyCode)/IsKeyJustPressed/IsKeyJustReleased，双缓冲状态
- 鼠标：GetMousePosition()/GetMouseDelta()/IsMouseButtonPressed()/GetMouseWheelDelta()
- KeyCode、MouseButton 枚举与 SDL 映射；hello_kale 验证按 Escape 退出

[2026-02-12] COMPLETED - phase1-1.3: 简单三角形渲染
- VulkanContext：CreateTriangleRendering / DestroyTriangleRendering（ImageViews、Render Pass、Framebuffers、Pipeline、Vertex Buffer、Command Pool/Buffers、Fence/Semaphore）
- 一帧流程：AcquireNextImage（WaitFence/ResetFence + vkAcquireNextImageKHR）→ RecordCommandBuffer（Clear + Draw 三角形）→ SubmitAndPresent（QueueSubmit + Present）
- 修正 frontFace 为 VK_FRONT_FACE_COUNTER_CLOCKWISE，三角形可见
- hello_kale：主循环中 Acquire → Record → SubmitAndPresent，验证三角形渲染流程
- 验证：cd build && cmake --build . -j 编译通过

[2026-02-12] COMPLETED - phase1-1.2: Vulkan 基础
- 实现 VulkanContext 类（vulkan_context.hpp / vulkan_context.cpp）
- CreateInstance：SDL_Vulkan_GetInstanceExtensions + 可选 VK_LAYER_KHRONOS_validation
- CreateSurface：SDL_Vulkan_CreateSurface(window, instance, &surface)
- SelectPhysicalDevice：选择支持 graphics + present 的 Queue Family
- CreateLogicalDevice：VK_KHR_SWAPCHAIN，单队列族
- CreateSwapchain：vsync(FIFO/MAILBOX)、backBufferCount、GetSwapchainImageCount/GetSwapchainImage
- hello_kale 验证：窗口 + Vulkan 初始化成功，swapchain images=3，800x600

[2026-02-12] COMPLETED - phase1-1.1: SDL3 与窗口系统
- 实现 WindowSystem 类与 WindowConfig 结构（width, height, title, fullscreen, resizable）
- WindowSystem::Create() 创建 SDL 窗口（SDL_INIT_VIDEO | GAMEPAD | EVENTS，SDL_WINDOW_VULKAN）
- WindowSystem::Destroy()、GetWindow()、GetNativeHandle()、GetWidth/GetHeight、Resize()
- PollEvents() 与 ShouldClose() 处理 SDL_EVENT_QUIT / SDL_EVENT_WINDOW_CLOSE_REQUESTED
- hello_kale 示例验证：创建 800x600 窗口、事件循环、尺寸与标题正确

[2026-02-12 21:43] COMPLETED - phase0-0.2: 集成 SDL3 库
- SDL3 库已通过 third_party/SDL 子目录集成
- CMakeLists.txt 已配置自动查找和使用 SDL3
- 创建了 test_sdl3_link.cpp 测试程序
- kale_device CMakeLists.txt 已链接 SDL3::SDL3
- 创建了 docs/SDL3_INTEGRATION.md 文档
- 配置支持两种方式：third_party/SDL（默认）和系统安装的 SDL3

[2026-02-12 21:40] COMPLETED - phase0-0.1: 集成 executor 库
- executor 库已通过系统安装的 find_package(executor) 找到
- executor_DIR=/usr/lib/cmake/executor
- CMake 编译标志包含 -DEXECUTOR_ENABLE_GPU
- kale_executor CMakeLists.txt 已配置链接 executor::executor
- 验证通过：CMake 配置正确识别 executor 库

[2026-02-12 20:00] INITIALIZE - Initializer Agent setup
- Created feature_list.json with 200+ features across 6 layers
- Created claude-progress.txt for progress tracking
- Identified current project status: executor layer TaskChannel and ExecutorFuture completed
- Next priority: Phase 0 (Infrastructure) - executor and SDL3 integration

[2026-02-12 20:00] PROJECT_OVERVIEW - Kale Rendering Engine v0.1.0
- Architecture: 6-layer modular design (kale_device, kale_executor, kale_resource, kale_scene, kale_pipeline, kale_engine)
- Technology Stack: Vulkan, SDL3, C++20, CMake
- External Dependencies: executor, glm, VMA, tinygltf, stb_image, assimp
- Design Documents: Complete architecture design for all 6 layers
- Task Lists: Detailed todolists for each layer with 12 development phases

[2026-02-12 20:00] CURRENT_STATUS - Development Phase Analysis
- Phase 0 (Infrastructure): Partial - executor integration needed, SDL3 integration needed
- Phase 1 (Device + Executor Basic): In Progress - Triangle rendering, input system pending
- Phase 2 (RDI Complete): Pending - Awaiting Phase 1 completion
- Phase 3-12: Pending - Awaiting prerequisite phases

[2026-02-12 20:00] COMPLETED_FEATURES
- phase1-1.5: TaskChannel 核心实现 (SPSC 无锁队列)
- phase1-1.6: TaskChannel 扩展与测试 (MPSC, 单元测试)
- phase1-1.7: ExecutorPromise / ExecutorFuture 实现
- phase1-1.8: then 续接方法实现
- phase1-1.9: async_load API 实现

[2026-02-12 20:00] NEXT_PRIORITIES - Critical Path Analysis
Based on dependency graph, the critical path for next development session:

1. **Phase 0 - Infrastructure** (BLOCKER)
   - [ ] phase0-0.1: 集成 executor 库 (find_package or add_subdirectory)
   - [ ] phase0-0.2: 集成 SDL3 库

2. **Phase 1 - Device Layer Foundation** (HIGH PRIORITY)
   - [ ] phase1-1.1: SDL3 与窗口系统 (依赖 phase0-0.2)
   - [ ] phase1-1.2: Vulkan 基础 (依赖 phase1-1.1)
   - [ ] phase1-1.3: 简单三角形渲染 (依赖 phase1-1.2) - MILESTONE
   - [ ] phase1-1.4: 输入系统基础 (依赖 phase1-1.1)

3. **Verification Tests Needed**
   - Test SDL3 window creation and event loop
   - Test Vulkan instance/device/swapchain creation
   - Test triangle rendering (end-to-end milestone)
   - Test keyboard/mouse input handling

[2026-02-12 20:00] ARCHITECTURE_NOTES
- Layer Dependencies: kale_device (base) → kale_executor → kale_resource → kale_scene → kale_pipeline → kale_engine (top)
- External Dependencies: executor (required), SDL3 (required), Vulkan (required for device layer)
- Build System: CMake 3.16+, supports vcpkg and manual dependency configuration
- Threading Model: Multi-threaded command recording (Phase 9), executor-based task scheduling

[2026-02-12 20:00] DEVELOPMENT_GUIDELINES
- Incremental Development: Complete one feature at a time, test thoroughly
- Clean State: Always leave code in compilable, documented state after each session
- Git Commits: Commit after each feature with descriptive messages
- Testing: Run tests after implementation, verify end-to-end functionality
- Documentation: Update this progress file and feature status in feature_list.json

[2026-02-12 20:00] TESTING_STRATEGY
For each feature implementation:
1. Build the project (cmake --build build)
2. Run unit tests (if available)
3. Run integration tests (hello_kale app)
4. Verify visual output (for rendering features)
5. Check for memory leaks (valgrind)
6. Update feature status to "completed" only after thorough testing

[2026-02-12 20:00] SESSION_TEMPLATE - For Future Coding Agents
Each coding session should follow this workflow:
1. Read claude-progress.txt to understand current state
2. Read feature_list.json to identify next feature
3. Run build tests to verify current state
4. Select one feature to implement (must be unblocked)
5. Implement the feature
6. Test the implementation
7. Update feature_list.json status to "completed"
8. Update this file with progress
9. Create git commit with descriptive message
10. Verify clean state before ending session

[2026-02-12 20:00] ENVIRONMENT_INFO
- Working Directory: /home/linductor/kale
- Build Directory: /home/linductor/kale/build
- CMake Configured: Yes (Release build)
- Executor Library: Needs integration
- SDL3 Library: Needs integration
- Vulkan SDK: Assumed installed (verify in next session)
